<!DOCTYPE html>

<head>
    <title>Mapua GWA Calculator</title>
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
</head>

<body>
    <div class="container item-stretch mx-auto p-5 shadow-2xl">
        <h1 class="text-center text-4xl font-bold pb-10">Mapua GWA Calculator</h1>
        <form id="tblForm">
            <table class="table-fixed w-full">
                <thead>
                    <tr>
                        <th class="w-full px-5 py-2">SUBJECT</th>
                        <th class="w-full px-5 py-2">GRADE</th>
                        <th class="w-full px-5 py-2">UNITS</th>
                    </tr>
                </thead>
                <tbody id="tbody">
                    <tr>
                        <td class="border-2"><input class="w-full shadow text-center" /></td>
                        <td class="border-2"><input class="w-full shadow text-center" /></td>
                        <td class="border-2"><input class="w-full shadow text-center" /></td>
                    </tr>
                </tbody>
            </table>
        </form>
        <div class="container w-full mx-auto pt-5 text-center">
            <button id="clearAll" onClick="clearAll()"
                class="bg-red-500 hover:bg-red-400 text-white font-bold py-2 px-4 border-b-4 border-red-700 hover:border-red-500 rounded">
                Clear all
            </button>
            <button id="removeRow" onClick="removeRow()"
                class="bg-red-500 hover:bg-red-400 text-white font-bold py-2 px-4 border-b-4 border-red-700 hover:border-red-500 rounded">
                Remove row
            </button>
            <button id="addSub" onClick="addSub()"
                class="bg-blue-500 hover:bg-blue-400 text-white font-bold py-2 px-4 border-b-4 border-blue-700 hover:border-blue-500 rounded">
                Add Subject
            </button>
            <br><br>
            <button id="compute" onClick="compute()"
                class="bg-blue-500 hover:bg-blue-400 text-white font-bold py-2 px-4 border-b-4 border-blue-700 hover:border-blue-500 rounded">
                Compute
            </button>
        </div>
        <div class="container w-full mx-auto pt-5 text-center">
            <p id="GWA" class="text-lg">
            </p>
        </div>

        <footer class="pt-10">
            Lagyan mo lahat ng GRADE at UNITS. Kahit di mo na lagyan yung subject.
        </footer>
    </div>

    <script>
        addSub = () => {
            removeTotal();
            
            let tbl = document.getElementById('tbody');

            var row = tbl.insertRow(-1);

            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);

            var input0 = document.createElement("input");
            input0.setAttribute("class", "w-full shadow text-center");
            var input1 = document.createElement("input");
            input1.setAttribute("class", "w-full shadow text-center");
            var input2 = document.createElement("input");
            input2.setAttribute("class", "w-full shadow text-center");

            cell0.setAttribute("class", "border-2");
            cell1.setAttribute("class", "border-2");
            cell2.setAttribute("class", "border-2");

            cell0.appendChild(input0);
            cell1.appendChild(input1);
            cell2.appendChild(input2);
        }

        removeRow = () => {
            removeTotal();

            let tbl = document.getElementById('tbody');

            let rowCount = tbl.rows.length;

            if (rowCount === 1) {
                alert("Last na nga dedelete mo pa? Gago ka ba?")
            } else {
                tbl.deleteRow(rowCount - 1);
            }
        }

        compute = () => {
            removeTotal();
            try {
                totalRow = document.getElementById("totalRow");
                totalRow.parentNode.removeChild(totalRow);
            } catch {
                console.log("No total")
            }

            let totalGrade = 0;
            let totalUnits = 0;
            let countedValue = 0;
            let tbl = document.getElementById('tbody');
            let gwaText = document.getElementById('GWA');
            var rowCount = tbl.rows.length;

            for (i = 0; i < rowCount; i++) {
                var tRow = tbl.rows[i];
                var tCell = tRow.cells[1];
                var tCell2 = tRow.cells[2];
                var grade = tCell.firstChild.value;
                var units = tCell2.firstChild.value;
                totalGrade += parseFloat(grade);
                totalUnits += parseFloat(units);
                countedValue += (grade * units)
            }

            let GWA = countedValue / totalUnits;

            console.log(Number.isNaN(totalGrade), totalUnits, totalGrade)

            if (Number.isNaN(totalGrade) || Number.isNaN(totalUnits)) {
                alert("Lagyan mo lahat ng GRADE at UNITS. Kung hindi tanggalin mo nalang lahat ng blangko.")
            } else {
                var row = tbl.insertRow(-1);
                row.setAttribute("id", "totalRow")

                var cell0 = row.insertCell(0);
                var cell1 = row.insertCell(1);
                var cell2 = row.insertCell(2);

                cell0.setAttribute("class", "w-full text-center");
                cell1.setAttribute("class", "w-full text-center");
                cell2.setAttribute("class", "w-full text-center");
                cell0.innerHTML = "TOTAL";
                cell1.innerHTML = totalGrade;
                cell2.innerHTML = totalUnits;
                gwaText.innerHTML = "GWA = " + GWA;

                if (GWA >= 1) {
                    console.log("GWA")
                }
            }
        }

        removeTotal = () => {
            try {
                totalRow = document.getElementById("totalRow");
                totalRow.parentNode.removeChild(totalRow);
            } catch {
                console.log("No total")
            }
        }

        clearAll = () => {
            removeTotal();

            tblForm = document.getElementById("tblForm");
            tblForm.reset();
            document.getElementById("GWA").innerHTML = ""
        }
    </script>
</body>